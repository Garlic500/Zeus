<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Buscador local con FlexSearch - Corregido</title>
  <script src="https://cdn.jsdelivr.net/npm/flexsearch@0.7.31/dist/flexsearch.bundle.js"></script>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; }
    input { width: 100%; padding: 10px; font-size: 1em; }
    .resultado { border-bottom: 1px solid #ccc; padding: 10px 0; }
    .titulo { font-weight: bold; }
    .descripcion { color: #555; }
  </style>
</head>
<body>

<h1>Buscador local con FlexSearch</h1>
<input type="text" id="buscador" placeholder="Escribe para buscar..." autocomplete="off" />

<div id="resultados"></div>

<script>
  const documentos = [
    { id: 1, titulo: "Manzana", descripcion: "Una fruta roja y dulce." },
    { id: 2, titulo: "Banana", descripcion: "Fruta amarilla y alargada, rica en potasio." },
    { id: 3, titulo: "Cereza", descripcion: "Fruta pequeña y roja, muy sabrosa." },
    { id: 4, titulo: "Durazno", descripcion: "Fruta con piel suave y pulpa dulce." },
    { id: 5, titulo: "Naranja", descripcion: "Fruta cítrica, rica en vitamina C." },
    { id: 6, titulo: "Pera", descripcion: "Fruta jugosa con forma característica." },
    { id: 7, titulo: "Piña", descripcion: "Fruta tropical con sabor dulce y ácido." },
  ];

  const index = new FlexSearch.Document({
    document: {
      id: "id",
      index: ["titulo", "descripcion"]
    }
  });

  documentos.forEach(doc => index.add(doc));

  const input = document.getElementById("buscador");
  const resultadosDiv = document.getElementById("resultados");

  input.addEventListener("input", () => {
    const query = input.value.trim().toLowerCase();
    resultadosDiv.innerHTML = "";

    if (!query) return;

    // Buscar en ambos campos y combinar resultados
    const resultadosTitulo = index.search(query, { field: "titulo", limit: 20, enrich: true });
    const resultadosDescripcion = index.search(query, { field: "descripcion", limit: 20, enrich: true });

    // Combinar resultados únicos
    const resultadosUnicos = new Map();

    resultadosTitulo.forEach(r => {
      r.result.forEach(res => resultadosUnicos.set(res.doc.id, res.doc));
    });

    resultadosDescripcion.forEach(r => {
      r.result.forEach(res => resultadosUnicos.set(res.doc.id, res.doc));
    });

    if (resultadosUnicos.size === 0) {
      resultadosDiv.innerHTML = "<p>No se encontraron resultados.</p>";
      return;
    }

    resultadosUnicos.forEach(doc => {
      const div = document.createElement("div");
      div.className = "resultado";
      div.innerHTML = `
        <div class="titulo">${doc.titulo}</div>
        <div class="descripcion">${doc.descripcion}</div>
      `;
      resultadosDiv.appendChild(div);
    });
  });
</script>

</body>
</html>
